# WhmcsEpay

WHMCS 易支付插件

## 简介

WhmcsEpay 是为 WHMCS 开发的易支付支付网关插件，支持支付宝和微信支付，方便您通过易支付平台接受客户付款。

## 功能特性

- **支持支付宝和微信支付**：同时支持两种主流支付方式。
- **自动检测支付状态**：在客户支付后，系统可自动检测支付状态并更新订单。
- **自定义手续费**：可根据支付方式设置不同的手续费率，方便财务记账。
- **二维码支付**：支持生成二维码，方便客户扫码支付。
- **多语言支持**：插件支持中文，提供良好的本地化体验。

## 系统要求

- **WHMCS 版本**：7.x 或更高版本 (环境8.10.1)
- **PHP 版本**：7.2 或更高版本
- **cURL 扩展**：PHP 需启用 cURL 扩展
- **OpenSSL 扩展**：PHP 需启用 OpenSSL 扩展

## 安装指南

1. **下载插件**

   下载最新版本的 WhmcsEpay 插件，并解压缩。

2. **上传文件**

   将解压后的文件上传到您的 WHMCS 安装目录下的 `modules/gateways/` 目录中。

   - `epay.php` 上传到 `modules/gateways/`
   - `notify.php` 上传到 `modules/gateways/epay/`
   - `lib` 文件夹上传到 `modules/gateways/`
   - `epay` 文件夹上传到 `modules/gateways/`
   - `callback/check_epay.php` 文件上传到 `modules/gateways/callback` 

3. **设置文件权限**

   确保上传的文件具有适当的读取权限，通常为万能权限 `777`。

## 配置指南

1. **登录 WHMCS 后台**

   使用管理员账号登录 WHMCS 管理后台。

2. **激活支付网关**

   导航到 **“系统设置”** > **“支付网关”**，在 **“所有支付网关”** 列表中找到 **“epay”**，点击激活。

3. **配置网关参数**

   在网关配置页面，填写以下参数：

   - **商户ID**：您的易支付商户ID。
   - **商户密钥**：您的易支付商户密钥。
   - **支付网关地址**：易支付平台的网关地址，例如 `https://epay.example.com`。
   - **支付方式**：选择默认的支付方式（支付宝或微信支付）。
   - **手续费率**：根据需要填写手续费率，支持统一费率或根据支付方式分别设置。

4. **保存配置**

   填写完毕后，点击 **“保存更改”** 按钮。

## 使用说明

1. **客户下单**

   客户在前台选择产品或服务并下单。

2. **选择支付方式**

   在支付页面，客户可以选择 **“epay”** 支付方式。

3. **完成支付**

   客户将被引导至支付页面，扫码或跳转至支付平台完成付款。

4. **订单更新**

   系统将自动检测支付状态，支付成功后自动更新订单状态。

## 常见问题

### 1. 支付状态未自动更新？

- 请确保您的服务器能够与易支付平台正常通信。
- 检查 `check_epay.php` 脚本是否正确配置，且路径正确。
- 确认在支付网关配置中填写的商户ID、密钥和网关地址正确无误。

### 2. 二维码无法显示？

- 确保已正确引入 `phpqrcode.php` 库，路径为 `modules/gateways/lib/phpqrcode.php`。
- 检查 PHP 是否启用了 GD 库（用于图像处理）。

### 3. 手续费如何设置？

- 在支付网关配置中，填写手续费率，支持统一费率或根据支付方式分别设置。
- 手续费仅用于财务记账，不会向客户额外收取。

## 更新日志

### v1.0.0

- 初始版本发布。

## 许可证

本插件基于 MIT 许可证开源，详细信息请查看 [LICENSE](LICENSE) 文件。

## 技术支持

如在使用过程中遇到问题，欢迎提交 [Issue](https://github.com/Aerovrra/WhmcsEpay/issues)，或通过以下方式联系我们：

- **Telegram**：@aeapi (不提供免费技术支持)
